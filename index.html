<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PixelGen - Pixel Art Asset Generator</title>
    <link rel="stylesheet" href="/src/style.css">
</head>
<body>
    <!-- Navigation -->
    <nav class="nav-bar">
        <div class="nav-container">
            <h1 class="nav-title">PixelGen</h1>
            <div class="nav-links">
                <button class="nav-link active" data-view="generator">Generator</button>
                <button class="nav-link" data-view="inspector">Inspector</button>
            </div>
        </div>
    </nav>

    <!-- Generator View -->
    <div id="generator-view" class="view-container active">
    <div class="container">
        <div class="input-group">
            <label for="input-field">Describe your sprite:</label>
            <input type="text" id="input-field" placeholder="e.g. a knight with a sword, a red dragon, a treasure chest...">

            <div class="controls-row">
                <div class="control">
                    <label for="console-select">System:</label>
                    <select id="console-select">
                        <!-- populated dynamically from palettes.js -->
                    </select>
                </div>
                <div class="control">
                    <label for="sprite-size">Size:</label>
                    <select id="sprite-size">
                        <!-- populated dynamically based on selected console -->
                    </select>
                </div>
                <div class="control">
                    <label for="model-select">AI Model:</label>
                    <select id="model-select">
                        <!-- populated dynamically from model-service.js -->
                    </select>
                </div>
            </div>

            <div class="controls-row">
                <div class="control">
                    <label for="pipeline-mode">Pipeline:</label>
                    <select id="pipeline-mode">
                        <option value="enhanced" selected>Enhanced (OKLAB)</option>
                        <option value="classic">Classic (sRGB)</option>
                    </select>
                </div>
                <div class="control">
                    <label for="dither-mode">Dithering:</label>
                    <select id="dither-mode">
                        <!-- populated dynamically based on pipeline mode -->
                    </select>
                </div>
                <div class="control">
                    <label for="show-grid">Grid:</label>
                    <input type="checkbox" id="show-grid">
                </div>
                <div class="control">
                    <label for="transparent-bg">Transparent BG:</label>
                    <input type="checkbox" id="transparent-bg">
                </div>
                <div class="control">
                    <label for="outlines">Outlines:</label>
                    <input type="checkbox" id="outlines" checked>
                </div>
                <div class="control">
                    <label for="cleanup">Cleanup:</label>
                    <input type="checkbox" id="cleanup" checked>
                </div>
                <button id="generate-btn">Generate</button>
            </div>

            <div class="controls-row negative-prompt-row">
                <div class="control control-wide">
                    <label for="negative-prompt">Avoid:</label>
                    <input type="text" id="negative-prompt" placeholder="blurry, realistic, photographic, 3d render...">
                </div>
                <div class="control">
                    <label for="seed-input">Seed:</label>
                    <input type="number" id="seed-input" placeholder="random" min="0" max="999999">
                </div>
            </div>
        </div>

        <div class="controls-row animation-row">
                <div class="control">
                    <label for="anim-state">Animation:</label>
                    <select id="anim-state">
                        <!-- populated dynamically from animation-states.js -->
                    </select>
                </div>
                <div class="control">
                    <label for="view-select">View:</label>
                    <select id="view-select">
                        <!-- populated dynamically from animation-states.js -->
                    </select>
                </div>
                <div class="control frame-control">
                    <label>Frame:</label>
                    <div class="frame-nav">
                        <button type="button" id="frame-prev" class="frame-btn" title="Previous frame">◀</button>
                        <span id="frame-indicator">1 / 2</span>
                        <button type="button" id="frame-next" class="frame-btn" title="Next frame">▶</button>
                    </div>
                </div>
                <button type="button" id="gen-all-frames" class="btn-secondary" title="Generate all frames for this animation (one API call per frame)">Gen All Frames</button>
                <button type="button" id="gen-sheet" class="btn-secondary btn-accent" title="Generate entire sprite sheet in one image (better consistency)">Gen Sheet</button>
            </div>

        <div id="console-info" class="console-info"></div>

        <div class="output-group">
            <div class="output-panel">
                <label>Source (AI generated):</label>
                <div id="source-output" class="canvas-container">
                    <img id="source-image" alt="Generated source image" style="display:none;">
                    <div id="source-placeholder" class="placeholder">Enter a prompt and click Generate</div>
                </div>
            </div>
            <div class="output-panel">
                <label id="pixel-label">Pixel Art:</label>
                <div id="pixel-output" class="canvas-container">
                    <canvas id="pixel-canvas"></canvas>
                    <div id="pixel-placeholder" class="placeholder">Pixel art will appear here</div>
                </div>
            </div>
        </div>

        <div class="frame-strip-section">
            <label>Frames:</label>
            <div id="frame-strip" class="frame-strip"></div>
        </div>

        <!-- Animation Preview -->
        <div class="preview-section">
            <div class="preview-header">
                <label>Animation Preview:</label>
                <div class="preview-controls">
                    <button type="button" id="play-btn" class="frame-btn" title="Play / Pause">▶</button>
                    <button type="button" id="stop-btn" class="frame-btn" title="Stop">⏹</button>
                    <div class="control fps-control">
                        <label for="fps-input">FPS:</label>
                        <input type="number" id="fps-input" value="8" min="1" max="30" step="1">
                    </div>
                    <div class="control">
                        <label for="ping-pong">Ping-pong:</label>
                        <input type="checkbox" id="ping-pong">
                    </div>
                    <div class="control">
                        <label for="onion-skin">Onion skin:</label>
                        <input type="checkbox" id="onion-skin">
                    </div>
                </div>
            </div>
            <div class="preview-canvas-wrap">
                <canvas id="preview-canvas"></canvas>
                <div id="preview-placeholder" class="placeholder">Generate frames to preview animation</div>
            </div>
        </div>

        <!-- Save / Export -->
        <div class="save-section">
            <div class="control">
                <label for="char-name">Character name:</label>
                <input type="text" id="char-name" placeholder="e.g. knight, dragon..." value="">
            </div>
            <button type="button" id="save-frames-btn" class="btn-secondary" title="Save frames to browser storage">Save Frames</button>
            <button type="button" id="export-sheet-btn" class="btn-secondary" title="Download sprite sheet PNG + JSON atlas">Export Sheet</button>
            <button type="button" id="load-btn" class="btn-secondary" title="Load saved frames">Load</button>
        </div>

        <div id="status" class="status"></div>

        <!-- Prompt Debug -->
        <details id="prompt-debug" class="prompt-debug">
            <summary>Show Prompt Details</summary>
            <div class="prompt-debug-content">
                <div class="prompt-field">
                    <label>Prompt sent:</label>
                    <pre id="debug-prompt">—</pre>
                </div>
                <div class="prompt-field">
                    <label>Negative prompt:</label>
                    <pre id="debug-negative">—</pre>
                </div>
                <div class="prompt-field">
                    <label>Request:</label>
                    <pre id="debug-url">—</pre>
                </div>
            </div>
        </details>
    </div>
    </div>

    <!-- Inspector View -->
    <div id="inspector-view" class="view-container">
        <div class="container">
            <h2>Request Inspector</h2>
            <p class="inspector-description">View raw model input and output from the last generation request.</p>
            
            <div class="inspector-section">
                <h3>Request Details</h3>
                <div class="inspector-field">
                    <label>Provider:</label>
                    <div id="inspector-provider" class="inspector-value">—</div>
                </div>
                <div class="inspector-field">
                    <label>Model:</label>
                    <div id="inspector-model" class="inspector-value">—</div>
                </div>
                <div class="inspector-field">
                    <label>Type:</label>
                    <div id="inspector-type" class="inspector-value">—</div>
                </div>
                <div class="inspector-field">
                    <label>Dimensions:</label>
                    <div id="inspector-dimensions" class="inspector-value">—</div>
                </div>
            </div>

            <div class="inspector-section">
                <h3>Enhanced Prompt</h3>
                <pre id="inspector-prompt" class="inspector-code">—</pre>
            </div>

            <div class="inspector-section">
                <h3>Negative Prompt</h3>
                <pre id="inspector-negative" class="inspector-code">—</pre>
            </div>

            <div class="inspector-section">
                <h3>Request URL</h3>
                <pre id="inspector-url" class="inspector-code">—</pre>
            </div>

            <div class="inspector-section">
                <h3>Configuration</h3>
                <pre id="inspector-config" class="inspector-code">—</pre>
            </div>
        </div>
    </div>

    <script type="module" src="/src/main.js"></script>
</body>
</html>
